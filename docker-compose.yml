version: "3.7"

services:
  elasticsearch:
    container_name: elasticsearch
    build: ./dataservice
    ports:
      - 9200:9200
      - 9300:9300
    environment:
      - discovery.type=single-node
    volumes:
      - ./dataservice/backup/:/home/backup/
    networks:
      - elasticsearch-init-network
      - elasticsearch-network
    restart: always
  initelasticsearch:
    container_name: init-elasticsearch
    build: ./initservice
    environment:
      - ELASTICSEARCH_HOST=elasticsearch:9200
    depends_on:
      - elasticsearch
    command:
      [
        "sh",
        "-c",
        "/bootstrap/wait-for-it.sh elasticsearch:9200 -t 0 --strict -- /bootstrap/bootstrap.sh",
      ]
    networks:
      - elasticsearch-init-network
  progressview:
    container_name: progressview
    build: ./progressview
    ports:
      - 9082:80
    depends_on:
      - elasticsearch
      - initelasticsearch
    networks:
      - elasticsearch-network
    restart: always
  statusview:
    container_name: statusview
    build: ./statusview
    ports:
      - 9083:80
    depends_on:
      - elasticsearch
      - initelasticsearch
    networks:
      - elasticsearch-network
    restart: always
networks:
  elasticsearch-init-network:
  elasticsearch-network:
